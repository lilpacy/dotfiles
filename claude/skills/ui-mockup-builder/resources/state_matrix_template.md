# State Matrix

画面ごとの主要状態を一覧化し、例外や落とし穴を先に潰す。

---

## 1. Overview(概要)
各画面で考慮すべき状態を「画面×状態」のマトリクスで整理する。

### 状態の定義
| State       | Description                                      | Example                          |
|-------------|--------------------------------------------------|----------------------------------|
| Normal      | データが存在し、正常に表示されている状態         | ユーザー一覧に10件表示           |
| Empty       | データが0件の場合                                | 「まだユーザーがいません」       |
| Loading     | データ読み込み中                                 | Spinner / Skeleton UI            |
| Error       | エラーが発生した状態                             | 「接続に失敗しました」           |
| Success     | 操作完了後の成功フィードバック                   | Toast「保存しました」            |
| Disabled    | 条件未達で操作不可                               | ボタングレーアウト               |
| Partial     | 一部データのみ表示(権限制限等)                   | 一部のフィールドがマスク         |

---

## 2. State Matrix(状態マトリクス)

### 表の見方
- ✅: 対応必須
- ⚠️: 対応推奨
- ➖: 対応不要
- 🚧: 未確定(Open Question)

### Matrix

| Screen ID           | Normal | Empty | Loading | Error | Success | Disabled | Partial |
|---------------------|--------|-------|---------|-------|---------|----------|---------|
| `dashboard`         | ✅     | ✅    | ✅      | ✅    | ➖      | ➖       | ⚠️      |
| `user-list`         | ✅     | ✅    | ✅      | ✅    | ➖      | ➖       | ➖      |
| `user-detail`       | ✅     | ➖    | ✅      | ✅    | ✅      | ⚠️       | ⚠️      |
| `user-edit`         | ✅     | ➖    | ✅      | ✅    | ✅      | ✅       | ➖      |
| `user-create`       | ✅     | ➖    | ➖      | ✅    | ✅      | ✅       | ➖      |
| `settings`          | ✅     | ➖    | ✅      | ✅    | ✅      | ⚠️       | ➖      |

---

## 3. State Details(状態詳細)

### 3.1 Dashboard

#### Normal(通常)
- 統計カード:4つ(ユーザー数/アクティブ率/月間成長率/エラー率)
- グラフ:直近30日のアクティブユーザー数推移
- 最近のアクティビティ:5件表示

#### Empty(空)
- 統計カード:すべて「0」または「N/A」
- グラフ:「データがありません」
- 最近のアクティビティ:「まだアクティビティがありません」
- アクション:「ユーザーを作成」ボタン

#### Loading(ローディング)
- 統計カード:Skeleton UI(4つ)
- グラフ:Skeleton UI
- 最近のアクティビティ:Skeleton UI(5件)

#### Error(エラー)
- 全体にエラーメッセージ表示:「データの読み込みに失敗しました」
- アクション:「再試行」ボタン

#### Partial(一部のみ)
- 権限がない統計カードは「権限がありません」と表示
- グラフは表示、最近のアクティビティは非表示

---

### 3.2 User List

#### Normal(通常)
- テーブルに10-20件のユーザーを表示
- ページネーション表示
- ソート・フィルタ機能が有効

#### Empty(空)
- テーブルの代わりに「まだユーザーがいません」
- アクション:「ユーザーを作成」ボタン

#### Loading(ローディング)
- **初回読み込み**:テーブル全体をSkeleton UIで表示(10行)
- **再読み込み**:テーブルを残したまま、上部にSpinner表示

#### Error(エラー)
- テーブルの代わりにエラーメッセージ:「ユーザーの読み込みに失敗しました」
- アクション:「再試行」ボタン

---

### 3.3 User Detail

#### Normal(通常)
- ユーザー情報カード(アバター/名前/Email/ステータス/作成日)
- アクションボタン(編集/削除)
- タブ(概要/アクティビティ/設定)

#### Loading(ローディング)
- ページ全体をSkeleton UIで表示

#### Error(エラー)
- ページ全体にエラーメッセージ:「ユーザー情報の読み込みに失敗しました」
- アクション:「一覧に戻る」ボタン

#### Success(成功)
- 編集・削除完了後、Toast通知:「ユーザー情報を更新しました」
- 3秒で自動非表示

#### Disabled(無効)
- 削除ボタン:自分自身のアカウントの場合は無効化
- ツールチップ:「自分自身のアカウントは削除できません」

#### Partial(一部のみ)
- 権限がないフィールドは「***」でマスク
- 編集・削除ボタンは非表示

---

### 3.4 User Edit

#### Normal(通常)
- フォームに既存データが入力済み
- 保存・キャンセルボタンが有効

#### Loading(ローディング)
- **データ読み込み中**:フォーム全体をSkeleton UIで表示
- **保存中**:保存ボタンがLoading状態、disabled

#### Error(エラー)
- **バリデーションエラー**:フィールドごとに赤いボーダー + エラーメッセージ
- **保存エラー**:フォーム上部にエラーメッセージ:「保存に失敗しました」

#### Success(成功)
- Toast通知:「ユーザー情報を更新しました」
- 詳細ページに遷移

#### Disabled(無効)
- フォームの一部フィールドが編集不可(例:作成日)
- 保存ボタン:必須フィールドが未入力の場合は無効化

---

### 3.5 User Create

#### Normal(通常)
- 空のフォーム
- 作成・キャンセルボタンが有効

#### Error(エラー)
- **バリデーションエラー**:フィールドごとに赤いボーダー + エラーメッセージ
- **作成エラー**:フォーム上部にエラーメッセージ:「ユーザーの作成に失敗しました」

#### Success(成功)
- Toast通知:「ユーザーを作成しました」
- 一覧ページに遷移

#### Disabled(無効)
- 作成ボタン:必須フィールドが未入力の場合は無効化
- ツールチップ:「すべての必須フィールドを入力してください」

---

### 3.6 Settings

#### Normal(通常)
- 設定フォーム(アカウント設定/通知設定/セキュリティ設定)
- 保存・リセットボタンが有効

#### Loading(ローディング)
- **データ読み込み中**:フォーム全体をSkeleton UIで表示
- **保存中**:保存ボタンがLoading状態、disabled

#### Error(エラー)
- **バリデーションエラー**:フィールドごとに赤いボーダー + エラーメッセージ
- **保存エラー**:フォーム上部にエラーメッセージ:「保存に失敗しました」

#### Success(成功)
- Toast通知:「設定を保存しました」

#### Disabled(無効)
- 一部の設定が権限不足で無効化
- ツールチップ:「この設定を変更する権限がありません」

---

## 4. Common Patterns(共通パターン)

### Loading Pattern
- **初回読み込み**:Skeleton UI / Spinner
- **再読み込み**:データを残したまま、上部にSpinner overlay
- **保存中**:ボタンをLoading状態にし、二重送信を防ぐ

### Error Pattern
- **ネットワークエラー**:「接続に失敗しました。再試行してください。」
- **権限エラー**:「この操作を実行する権限がありません。」
- **バリデーションエラー**:フィールドごとにエラーメッセージ表示
- **サーバーエラー**:「サーバーエラーが発生しました。しばらくしてから再試行してください。」

### Success Pattern
- **Toast通知**:3秒で自動非表示
- **位置**:右上または下部中央
- **アイコン**:チェックマーク

### Empty Pattern
- **メッセージ**:「まだ〇〇がありません」
- **アクション**:「新規作成」ボタン
- **イラスト**:(任意)空状態を表すイラスト

---

## 5. Edge Cases(エッジケース)

### データ量に関する考慮
- **0件**:Empty状態
- **1-10件**:Normal状態(ページネーションなし)
- **11件以上**:Normal状態(ページネーションあり)
- **1000件以上**:仮想スクロール推奨

### 文字数に関する考慮
- **短い名前**:(例)「太郎」→ レイアウト崩れなし
- **長い名前**:(例)「これは非常に長いユーザー名の例です...」→ 省略表示(...)
- **多言語**:英語(短い) vs 日本語(長い)で表示崩れチェック

### 権限に関する考慮
- **管理者**:すべての機能が有効
- **一般ユーザー**:一部の機能が無効化
- **ゲスト**:閲覧のみ

---

## 6. Open Questions(未確定事項)

| Question                                      | Owner       | Due Date   | Status     |
|-----------------------------------------------|-------------|------------|------------|
| Empty状態のイラストを用意する?                | Design Team | 2025-01-15 | Open       |
| エラー時のリトライ回数上限は?                 | Backend     | 2025-01-20 | Open       |
| Loading時のSkeleton UIの形状は?              | Design Team | 2025-01-25 | Discussing |
| Toast通知の表示位置は右上?下部中央?           | UX Team     | 2025-01-30 | Open       |
